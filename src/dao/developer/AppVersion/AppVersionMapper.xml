<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="dao.developer.AppVersion.AppVersionMapper">
 	<!--根据appid查询版本信息-->
 	<select id="getAppVersionList" resultMap="AppVersionAppName">
 		SELECT v.*,i.softwareName as appName
 		,(SELECT valueName FROM data_dictionary d WHERE typeCode='PUBLISH_STATUS' AND v.publishStatus=d.valueId) AS publishStatusName
		FROM  app_version v INNER JOIN app_info i ON v.appId=i.id
		WHERE appId =#{appId}
 	</select>
 	<resultMap type="AppVersion" id="AppVersionAppName">
 		<result column="appName" property="appName"/>
 		<result column="publishStatusName" property="publishStatusName"/>
 	</resultMap>
 	<!-- 添加数据 -->
 	<insert id="addAppVersion" parameterType="AppVersion">
 		INSERT INTO 
 		app_version(appId,versionNo,versionInfo,publishStatus,downloadLink,versionSize,createdBy,creationDate,apkLocPath,apkFileName)
		VALUES(#{appId},#{versionNo},#{versionInfo},#{publishStatus},#{downloadLink},#{versionSize},#{createdBy},#{creationDate},#{apkLocPath},#{apkFileName})
 	</insert>
 	<!-- 根据id查询数据 -->
 	<select id="getAppVersionById" resultType="AppVersion">
 		SELECT v.*,i.softwareName as appName
 		,(SELECT valueName FROM data_dictionary d WHERE typeCode='PUBLISH_STATUS' AND v.publishStatus=d.valueId) AS publishStatusName
		FROM  app_version v INNER JOIN app_info i ON v.appId=i.id
		WHERE v.id=#{id}
 	</select>
 	<!-- 修改信息 -->
 	<update id="modifyappversion" parameterType="AppVersion">
 		UPDATE app_version
		<set>
			<if test="versionSize!=null and versionSize!=''">
				versionSize=#{versionSize},
			</if>
			<if test="publishStatus!=null and publishStatus!=''">
				publishStatus=#{publishStatus},
			</if>
			<if test="versionInfo!=null and versionInfo!=''">
				versionInfo=#{versionInfo},
			</if>
			<if test="modifyDate!=null">
				modifyDate=#{modifyDate},
			</if>
			<if test="modifyBy!=null">
				modifyBy=#{modifyBy},
			</if>
			<if test="downloadLink!=''">
				downloadLink=#{downloadLink},
				apkLocPath=#{apkLocPath},
				apkFileName=#{apkFileName},
			</if>
		</set>
		WHERE id=#{id}
 	</update>
 	<!-- 查询离当前系统时间最近的数据 -->
 	<select id="getAppInfoBycreationDateDESC" resultType="AppVersion">
 		SELECT * FROM app_version
 		WHERE appId=#{appId}
		ORDER BY creationDate DESC 
		LIMIT 0,1	
 	</select>
 	<!-- 根据appId删除版本 -->
 	<delete id="delAppVesionByAppId">
 		DELETE from app_version WHERE appId=#{appId}
 	</delete>
 </mapper> 